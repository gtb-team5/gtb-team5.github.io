<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>canvasで図形を描く</title>
</head>
<body>
<button id="start" >start</button>
<button id="stop" >stop</button>


<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/6.3.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.10.1/firebase-storage.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

<script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
        apiKey: "AIzaSyApupTZW_6WvuTnf7b3o9AeOgxv4Nsbpuk",
        authDomain: "gtb-team5.firebaseapp.com",
        databaseURL: "https://gtb-team5.firebaseio.com",
        projectId: "gtb-team5",
        storageBucket: "gtb-team5.appspot.com",
        messagingSenderId: "663345784773",
        appId: "1:663345784773:web:dc9887a69dded49f"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
</script>

<script>

    // Create a root reference
    var storageRef = firebase.storage().ref();

    // Create a reference to 'mountains.jpg'
    var testRef = storageRef.child('test.webm');

    //------------音声に関する処理-------------------------------------
    const start = document.querySelector('#start');
    const stop = document.querySelector('#stop');

    let mediaRecorder = null;
    let mediaStream = null;

    start.addEventListener('click', () => {
        start.disabled = true;
        stop.disabled = false;

        const chunks = [];
        mediaRecorder = new MediaRecorder(mediaStream, {
            mimeType: 'audio/webm'
        });

        mediaRecorder.addEventListener('dataavailable', e => {
            if (e.data.size > 0) {
                chunks.push(e.data);
            }
        });

        mediaRecorder.addEventListener('stop', ()　=> {
            const a = document.createElement('a');
            var blob = new Blob(chunks);
            testRef.put(blob).then(function(snapshot){
                console.log('Uploaded a blob or file');
            })
        });

        mediaRecorder.start();
    });

    stop.addEventListener('click', () => {
        if (mediaRecorder === null) {
            return;
        }

        start.disabled = false;
        stop.disabled = true;

        mediaRecorder.stop();
        mediaRecorder = null;
    });

    navigator.mediaDevices.getUserMedia({
        audio: true,
        video: false
    }).then(stream => {
        mediaStream = stream;

        // ...
    }).catch(error => {
        console.log(error);
    });

</script>

</body>
<html>
