<!DOCTYPE html>
<html lang="ja">
    <head>
        <title>GIJIGORIのLPだよ！</title>
        <script src = "https://www.gstatic.com/firebasejs/5.8.4/firebase-app.js"></script>
        <script src = "https://www.gstatic.com/firebasejs/5.8.4/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-database.js"></script>
        <script src="https://unpkg.com/vue"></script>
        <script>
            //Iinitialize Firebase
            var firebaseConfig = {
                apiKey: "AIzaSyApupTZW_6WvuTnf7b3o9AeOgxv4Nsbpuk",
                authDomain: "gtb-team5.firebaseapp.com",
                databaseURL: "https://gtb-team5.firebaseio.com",
                projectId: "gtb-team5",
                storageBucket: "gtb-team5.appspot.com",
                messagingSenderId: "663345784773",
                appId: "1:663345784773:web:9855dd622cd52158"
            }

            // Initialize Firebase
            try{
                firebase.initializeApp(firebaseConfig);
            }catch (e) {
                console.log(e);
            }
            var messagesRef = firebase.database().ref('speech_messages');
        </script>
    </head>
        <p>GIJIGORIのメインページだよ！</p>
        <button type="button" onclick="logout();">ログアウト</button>
        <button id="start_button">議事録作成開始だよ！</button>

        <div id="content"></div>
        <div id="div1">wait...</div>

    <script>
        function logout(){
            firebase.auth().onAuthStateChanged((user) => {
                firebase.auth().signOut().then(() => {
                    console.log("ログアウトしました");
                    window.location.href = 'lp_proto.html';
                }).catch((error) => {
                    console.log(`ログアウト時にエラーが発生しました (${error})`);
                });
            });
        }
    </script>

    <script>
        //音声認識の準備・日本語の使用を宣言
        const speechRecognition = new webkitSpeechRecognition();
        speechRecognition.lang = 'ja-JP';

        //DOM操作用のオブジェクトを用意
        const startButton = document.getElementById('start_button');
        const content = document.getElementById('content');

        startButton.addEventListener('click', function () {
            //音声認識スタート
            speechRecognition.start();
        });

        speechRecognition.addEventListener('result', function (e) {
            //音声認識した結果をコンソールに表示
            console.log(e);

            //音声認識で取得した情報を,HTMLに表示する処理
            const text = e.results[0][0].transcript;
            content.innerText = text;
            //Firebaseへのデータの書き込み
            messagesRef.push({
                minutes: text
            });
        });

        //結果を表示として追加
        // Firebaseの既存メッセージを表示
        messagesRef.on('value', (snapshot) => {
            let data = snapshot.val();
            let result = '';
            //wait...を消去する処理
            document.querySelector('#div1').innerHTML = "";
            //firebase内の値を取ってきて表示
            for (let i in data) {

                //テキストボックスを生成してそこに表示
                let message = data[i];
                const div1 = document.getElementById("div1");
                const input = document.createElement("input");
                input.setAttribute("type","text");
                input.setAttribute("maxlength","100000");
                input.setAttribute("size","50");
                input.setAttribute("value",message.minutes);
                div1.appendChild(input);
                div1.appendChild(document.createElement('br'));
                console.log(div1);
            }
        })


    </script>
    </body>
</html>