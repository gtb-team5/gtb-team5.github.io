<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>音声認識サンプル</title>

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/6.3.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-database.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    </head>
    <body>
        <h2>音声認識サンプル</h2>
        <button id="start_button">start</button>
        <div id="content"></div>
        <div id="div1"></div>
        <ol id="list">wait...</ol>
        <script>
        // Firebaseに関する処理---------------------------------------------------------------------------------
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyApupTZW_6WvuTnf7b3o9AeOgxv4Nsbpuk",
            authDomain: "gtb-team5.firebaseapp.com",
            databaseURL: "https://gtb-team5.firebaseio.com",
            projectId: "gtb-team5",
            storageBucket: "gtb-team5.appspot.com",
            messagingSenderId: "663345784773",
            appId: "1:663345784773:web:9855dd622cd52158"
        }

        // Initialize Firebase
        try{
            firebase.initializeApp(firebaseConfig);
        }catch (e) {
            console.log(e);
        }
        var messagesRef = firebase.database().ref('speech_messages');


        //音声認識の準備・日本語の使用を宣言
        const speechRecognition = new webkitSpeechRecognition();
        speechRecognition.lang = 'ja-JP';

        //DOM操作用のオブジェクトを用意
        const startButton = document.getElementById('start_button');
        const content = document.getElementById('content');

        startButton.addEventListener('click',function(){
            //音声認識スタート
            speechRecognition.start();
        });

        speechRecognition.addEventListener('result',function(e){
            //音声認識した結果をコンソールに表示
            console.log(e);

            //音声認識で取得した情報を,HTMLに表示する処理
            const text = e.results[0][0].transcript;
            content.innerText = text;
            //Firebaseへのデータの書き込み
            messagesRef.push({
                minutes: text
            });
        });

        //結果を表示として追加
        // Firebaseの既存メッセージを表示
        messagesRef.on('value',(snapshot)=>{
            let data = snapshot.val();
            let result = '';
            for(let i in data) {
                let message = data[i];
                const div1 = document.getElementById("div1");
                result += '<li>' + message.minutes;

                document.querySelector('#list').innerHTML = result;
            }
        })

        //messagesRef.on('child_added', function(snapshot) {
        //    var msg = snapshot.val();
        //    console.log(msg.body);
        //   $('<li>').text(msg.name + ': ' + msg.minutes).prependTo('#messages');
        //});

        </script>
    <body>
<html>
